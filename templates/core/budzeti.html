{% extends "base.html" %}
{% block content %}
<h2 class="h4 mb-3">Bud≈æeti</h2>

<div class="card shadow-sm">
  <div class="card-body">
    <h3 class="h6">Dodaj bud≈æet</h3>
    <form method="post">{% csrf_token %}
      {{ form.as_p }}
      <button class="btn btn-success">Spremi</button>
    </form>
  </div>
</div>

<div class="card mt-4 shadow-sm">
  <div class="card-body">
    <h3 class="h6">Moji bud≈æeti</h3>
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>Kategorija</th>
            <th>Period</th>
            <th>Planirani bud≈æet</th>
            <th>Stvarni tro≈°kovi</th>
            <th>Preostalo</th>
            <th>% iskori≈°teno</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for budzet in items %}
            <tr>
              <td>{{ budzet.kategorija.naziv }}</td>
              <td>{{ budzet }}</td>
              <td>{{ budzet.iznos }} ‚Ç¨</td>
              <td>{{ budzet.get_actual_spending }} ‚Ç¨</td>
              <td class="{% if budzet.get_remaining_budget < 0 %}text-danger{% else %}text-success{% endif %}">
                {{ budzet.get_remaining_budget }} ‚Ç¨
              </td>
              <td>
                <div class="progress" style="height: 20px;">
                  <div class="progress-bar 
                    {% if budzet.get_percentage_used > 100 %}bg-danger
                    {% elif budzet.get_percentage_used > 80 %}bg-warning
                    {% else %}bg-success{% endif %}" 
                    role="progressbar" 
                    style="width: {{ budzet.get_percentage_used }}%">
                    {{ budzet.get_percentage_used|floatformat:1 }}%
                  </div>
                </div>
              </td>
              <td>
                {% if budzet.get_remaining_budget < 0 %}
                  <span class="badge bg-danger">Prekoraƒçen</span>
                {% elif budzet.get_percentage_used > 80 %}
                  <span class="badge bg-warning">Upozorenje</span>
                {% else %}
                  <span class="badge bg-success">U redu</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="text-muted">Nema bud≈æeta ‚Äî dodaj prvi bud≈æet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="mt-3">
  <a href="{% url 'budget_analysis' %}" class="btn btn-primary">
    üìä Detaljna analiza bud≈æeta
  </a>
</div>
{% endblock %}
