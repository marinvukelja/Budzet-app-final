{% extends "base.html" %}
{% block content %}
<h2 class="h4 mb-3">Transakcije</h2>

<form method="get" class="row g-2 align-items-end">
  <div class="col-sm-3">
    <label class="form-label">Tip</label>
    <select class="form-select" name="tip">
      <option value="">Sve</option>
      <option value="PRIHOD" {% if request.GET.tip == "PRIHOD" %}selected{% endif %}>Prihod</option>
      <option value="TROSAK" {% if request.GET.tip == "TROSAK" %}selected{% endif %}>Trošak</option>
    </select>
  </div>
  <div class="col-sm-3">
    <label class="form-label">Kategorija</label>
    <select class="form-select" name="kategorija">
      <option value="">Sve</option>
      {% for k in kategorije %}
        <option value="{{ k.id }}" {% if request.GET.kategorija == k.id|stringformat:"s" %}selected{% endif %}>{{ k.naziv }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-sm-2">
    <label class="form-label">Od</label>
    <input class="form-control" type="date" name="od" value="{{ request.GET.od }}">
  </div>
  <div class="col-sm-2">
    <label class="form-label">Do</label>
    <input class="form-control" type="date" name="do" value="{{ request.GET.do }}">
  </div>
  <div class="col-sm-2">
    <button class="btn btn-outline-primary w-100">Filtriraj</button>
  </div>
</form>

<div class="card mt-4 shadow-sm">
  <div class="card-body">
    <h3 class="h6">Dodaj transakciju</h3>
    <form method="post">{% csrf_token %}
      {{ form.as_p }}
      <button class="btn btn-success">Spremi</button>
    </form>

    {% with q=request.GET.urlencode %}
      <a class="btn btn-link mt-2 p-0" href="{% url 'transakcije_export' %}{% if q %}?{{ q }}{% endif %}">⬇️ Export CSV</a>
    {% endwith %}
  </div>
</div>

<div class="card mt-4 shadow-sm">
  <div class="card-body">
    <table class="table table-striped table-hover align-middle">
      <thead><tr><th>Datum</th><th>Kategorija</th><th>Račun</th><th>Iznos</th><th>Opis</th><th>Cilj</th></tr></thead>
      <tbody>
        {% for x in items %}
          <tr>
            <td>{{ x.datum }}</td>
            <td>{{ x.kategorija }}</td>
            <td>{{ x.racun|default:"N/A" }}</td>
            <td>{{ x.iznos }}</td>
            <td>{{ x.opis }}</td>
            <td>{{ x.doprinos_cilju }}</td>
          </tr>
        {% empty %}<tr><td colspan="6">Nema transakcija.</td></tr>{% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
